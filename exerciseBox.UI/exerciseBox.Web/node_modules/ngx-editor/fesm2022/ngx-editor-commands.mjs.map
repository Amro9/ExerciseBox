{"version":3,"file":"ngx-editor-commands.mjs","sources":["../../../projects/ngx-editor/commands/removeLink.ts","../../../projects/ngx-editor/commands/applyMark.ts","../../../projects/ngx-editor/commands/removeMark.ts","../../../projects/ngx-editor/commands/ngx-editor-commands.ts"],"sourcesContent":["import { EditorState, Transaction, type Command } from 'prosemirror-state';\n\nexport const removeLink = (): Command => {\n  return (state: EditorState, dispatch?: (tr: Transaction) => void): boolean => {\n    const { doc, selection, tr, schema } = state;\n    const { $head: { pos }, from, to } = selection;\n\n    const linkMark = schema.marks['link'];\n\n    // if the cursor is on the link without any selection\n    if (from === to) {\n      const $pos = doc.resolve(pos);\n      const linkStart = pos - $pos.textOffset;\n      const linkEnd = linkStart + $pos.parent.child($pos.index()).nodeSize;\n\n      tr.removeMark(linkStart, linkEnd, linkMark);\n    } else {\n      tr.removeMark(from, to, linkMark);\n    }\n\n    if (!tr.docChanged) {\n      return false;\n    }\n\n    dispatch?.(tr);\n    return true;\n  };\n};\n\nexport default removeLink;\n","import { MarkType } from 'prosemirror-model';\nimport { EditorState, TextSelection, Transaction, type Command } from 'prosemirror-state';\n\nimport { markApplies } from 'ngx-editor/helpers';\n\n// Ref: https://github.com/ProseMirror/prosemirror-commands/blob/master/src/commands.js\nexport const applyMark = (type: MarkType, attrs: Record<string, any> = {}): Command => {\n  return (state: EditorState, dispatch?: (tr: Transaction) => void): boolean => {\n    const { tr, selection } = state;\n    const { empty, ranges, $from, $to } = selection;\n\n    if (empty && selection instanceof TextSelection) {\n      const { $cursor } = selection;\n\n      if (!$cursor || !markApplies(state.doc, ranges, type)) {\n        return false;\n      }\n\n      tr.addStoredMark(type.create(attrs));\n      if (!tr.storedMarksSet) {\n        return false;\n      }\n\n      dispatch?.(tr);\n    } else {\n      tr.addMark($from.pos, $to.pos, type.create(attrs));\n\n      if (!tr.docChanged) {\n        return false;\n      }\n\n      dispatch?.(tr.scrollIntoView());\n    }\n\n    return true;\n  };\n};\n","import { MarkType } from 'prosemirror-model';\nimport { EditorState, TextSelection, Transaction, type Command } from 'prosemirror-state';\n\nimport { markApplies } from 'ngx-editor/helpers';\n\nexport const removeMark = (type: MarkType): Command => {\n  return (state: EditorState, dispatch?: (tr: Transaction) => void): boolean => {\n    const { tr, selection, storedMarks, doc } = state;\n    const { empty, ranges } = selection;\n\n    if (empty && selection instanceof TextSelection) {\n      const { $cursor } = selection;\n\n      if (!$cursor || !markApplies(state.doc, ranges, type)) {\n        return false;\n      }\n\n      if (type.isInSet(storedMarks || $cursor.marks())) {\n        tr.removeStoredMark(type);\n        dispatch?.(tr);\n        return true;\n      }\n    } else {\n      for (const range of ranges) {\n        const { $from, $to } = range;\n        const hasMark = doc.rangeHasMark($from.pos, $to.pos, type);\n\n        if (hasMark) {\n          tr.removeMark($from.pos, $to.pos, type);\n        }\n      }\n\n      if (!tr.docChanged) {\n        return false;\n      }\n\n      dispatch?.(tr.scrollIntoView());\n    }\n\n    return false;\n  };\n};\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}